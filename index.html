
<doctype html>
<html lang="en">
<head>
<title>Greg Doolittle - Mondrian Generator</title>
<style>
body {
	margin:0;
	padding: 0;
}
button#play {
	opacity:0;
	transition: opacity 250ms ease-in-out;
	position: absolute;
	bottom: 0;
	left: 50%;
	margin-left: -3em;
	width: 6em;
	text-align:center;
	background:#000;
	color:#FFF;
	padding: .5em;
	font-size: 2em;
	border: 0;
	font-family: sans-serif;
}
button#play:hover {
	box-shadow: inset 0 0 2em rgba(255,255,255,.25);
}
button#play:focus {
	outline: none;
}
button#play:active {
	background: #c94134;
	box-shadow: none;
}
body:hover button#play {
	opacity: 1;
	transition: opacity 250ms ease-in-out;
}
</style>
</head>
<body></body>

<script>
/*
 * mondrian.js
 * @Author Greg Doolittle
 * description: generates a mondrian-esque grid with randomly filled squares.
 */

function Mondrian( lineWidth, squareCount, density ) {
	this.lineColor = "#0a0a0a";
	this.lineWidth = lineWidth || ( window.innerWidth <  window.innerHeight) ? Math.round( window.innerWidth / 40 ) : Math.round( window.innerHeight / 40 );
	this.density = density || .5;
	this.squareCount = squareCount || 5;
	this.body = document.getElementsByTagName( "body" )[0];

	this.button = document.createElement( "button" );
	this.button.id = "play";
	this.button.innerHTML = "Next";
	this.body.appendChild( this.button );
	document.getElementById( "play" ).addEventListener( "click", function() {
		magicCanvas.paint(); 
	});
	this.canvas = document.createElement( "canvas" );
	this.canvas.width = window.innerWidth - 2 * this.lineWidth;
	this.canvas.height = window.innerHeight - 2 * this.lineWidth;
	this.context = this.canvas.getContext( "2d" );
	this.context.lineWidth = this.lineWidth;
	this.body.appendChild( this.canvas );
	this.canvas.style.border = this.lineWidth + "px solid "+ this.lineColor;
	this.context.fillStyles = ["#c94134", "#efca49", "#31578c", "#000000"]; // mondrian's standard colors
	// this.context.fillStyles = ["#cc0000", "#ffdd11", "#0066bb", "#000000"]; // brighter version of standard colors
	// this.context.fillStyles = ["#cc0000", "#ff5f42", "#870006", "#000000"]; // monochrome in red
	// this.context.fillStyles = ["#f59331", "#3fb34f", "#615ea6", "#000000"]; // eew... secondaries
}

Mondrian.prototype.paint = function () {
	this.context.clearRect( 0, 0, this.canvas.width, this.canvas.height );
	this.context.beginPath();
	this.xrow = RandomSet( this.squareCount, this.canvas.width, this.lineWidth );
	this.yrow = RandomSet( this.squareCount, this.canvas.height, this.lineWidth );

	// draw squares
	for ( i = 0; i <= this.squareCount; i++ ) {
		var j = 0;
		if ( Math.random() > this.density ) {
			this.context.fillStyle = this.context.fillStyles[ Math.floor( Math.random() * this.context.fillStyles.length )];
			this.context.fillRect( this.xrow[i - 1 ] + this.lineWidth / 2, 0, this.xrow[i] - this.xrow[i - 1] - this.lineWidth, this.yrow[j] );
			this.context.strokeStyle = this.lineColor;
			this.context.stroke();
		}
		for ( j; j <= this.squareCount; j++ ) {
			if ( Math.random() > this.density ) {
				this.context.fillStyle = this.context.fillStyles[Math.floor( Math.random() * this.context.fillStyles.length )];
				this.context.fillRect( this.xrow[i - 1 ] + this.lineWidth / 2, this.yrow[j - 1 ] + this.lineWidth / 2, this.xrow[i] - this.xrow[i - 1] - this.lineWidth, this.yrow[j] - this.yrow[j - 1] - this.lineWidth );
				this.context.stroke();
				if ( i === 0 ) {
					this.context.fillStyle = this.context.fillStyles[Math.floor( Math.random() * this.context.fillStyles.length )];
					this.context.fillRect( 0, this.yrow[j - 1 ] + this.lineWidth / 2, this.xrow[i], this.yrow[j] - this.yrow[j - 1] - this.lineWidth );
					this.context.stroke();
				}
			}	
		}
	}

	// draw grid
	for ( each in this.xrow ) {
		this.context.moveTo( this.xrow[each], 0 );
		this.context.lineTo( this.xrow[each], this.canvas.height );
		this.context.strokeStyle = this.lineColor;
		this.context.stroke();
	}
	for ( each in this.yrow ) {
		this.context.moveTo( 0, this.yrow[each] );
		this.context.lineTo( this.canvas.width, this.yrow[each] );
		this.context.strokeStyle = this.lineColor;
		this.context.stroke();
	}
}

function sortNumber( a, b ) {
    return a - b; // has to add this because javascript can't natively sort arrays of integers. #wtfjavascript
}
function randomSign() {
	if ( Math.random() > .5 ) {
		return 1;
	} else {
		return -1;
	}
}

function RandomSet( length, range, lineWidth ) {
	// rather than use a truly random set, this creates a list of evenly spaced numbers, then adds a modifier that helps spread the grid out more *mondrian-ishly*
	var i = 1, result = new Array();
	result[0] = 0 - lineWidth;
	for ( i; i < length; i++ ) {
		result[i] = Math.round( i * range/length + randomSign() * Math.ceil( Math.random() * range / length ) );
	}
	result = result.sort( sortNumber );
	var i = 0;
	for ( i; i < length; i++ ) {
		if ( i > 0 ) {
			if ( result[i] - result[i - 1] < 3 * lineWidth ) {
				result.splice( i, 1 );
			}
		}
	}
	result[result.length] = range + ( 2 * lineWidth );
	return result;
} 

var magicCanvas = new Mondrian();
magicCanvas.paint();

</script>

</html>
